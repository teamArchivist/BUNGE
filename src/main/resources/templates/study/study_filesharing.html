<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Folder List</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        .button-container {
            margin-bottom: 20px;
        }

        .create-folder-button,
        .upload-file-button,
        .confirm-upload-button,
        .go-to-parent-button {
            margin-right: 10px;
            padding: 10px 20px;
            background-color: #007bff;
            color: #fff;
            text-decoration: none;
            cursor: pointer;
            border: none;
            border-radius: 5px;
        }

        .create-folder-button:hover,
        .upload-file-button:hover,
        .confirm-upload-button:hover,
        .go-to-parent-button:hover {
            background-color: #0056b3;
        }

        .confirm-upload-button {
            background-color: #28a745;
            cursor: not-allowed;
        }

        .confirm-upload-button.enabled {
            cursor: pointer;
            background-color: #28a745;
        }

        .confirm-upload-button.enabled:hover {
            background-color: #218838;
        }

        .create-folder-form,
        .upload-file-form {
            display: none;
            margin-top: 10px;
        }

        .create-folder-form h2,
        .upload-file-form h2 {
            margin-top: 0;
            margin-bottom: 10px;
        }

        .create-folder-form form,
        .upload-file-form form {
            margin-top: 10px;
        }

        .create-folder-form label,
        .upload-file-form label {
            display: block;
            margin-bottom: 5px;
        }

        .create-folder-form input[type="text"],
        .upload-file-form input[type="file"] {
            width: 300px;
            padding: 8px;
            font-size: 14px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }

        .main-content {
            background-color: #c3bdbd; /* ì›í•˜ëŠ” ë°°ê²½ìƒ‰ ì§€ì • */
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); /* ê·¸ë¦¼ì íš¨ê³¼ ì¶”ê°€ */
        }

        ul {
            list-style-type: none;
            padding: 0;
            display: flex;
            flex-wrap: wrap;
        }

        li {
            width: 150px;
            height: 150px;
            border: 1px solid #ccc;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            margin: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            background-size: contain; /* ì´ë¯¸ì§€ê°€ ìš”ì†Œ ì•ˆì— ë§ê²Œ ì¡°ì • */
            background-repeat: no-repeat;
            background-position: center;
            background-color: #fff; /* ë°°ê²½ìƒ‰ ì¶”ê°€ */
        }

        /* í´ë” ì•„ì´ì½˜ */
        .folder-link {
            text-decoration: none;
            color: inherit;
            display: block;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }

        .folder-link:hover {
            background-color: #f0f0f0;
            border-radius: 5px;
        }

        .folder-link .link-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
        }

        .folder-link img {
            max-width: 80px; /* ì´ë¯¸ì§€ ìµœëŒ€ ë„ˆë¹„ ì„¤ì • */
            max-height: 80px; /* ì´ë¯¸ì§€ ìµœëŒ€ ë†’ì´ ì„¤ì • */
        }

        /* íŒŒì¼ ì•„ì´ì½˜ */
        .file-link {
            text-decoration: none;
            color: inherit;
            display: block;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }

        .file-link:hover {
            background-color: #f0f0f0;
            border-radius: 5px;
        }

        .file-link .link-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
        }

        .file-link img {
            max-width: 80px; /* ì´ë¯¸ì§€ ìµœëŒ€ ë„ˆë¹„ ì„¤ì • */
            max-height: 80px; /* ì´ë¯¸ì§€ ìµœëŒ€ ë†’ì´ ì„¤ì • */
        }

        .link-content span {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .folder-link img,
        .file-link img {
            margin-bottom: 10px; /* ì´ë¯¸ì§€ì™€ í…ìŠ¤íŠ¸ ì‚¬ì´ì— ê°„ê²© ì¶”ê°€ */
        }
        
        .clickable-box {
            display: block;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 10px;
            text-align: center;
        }

        .clickable-box a {
            text-decoration: none;
            color: #007bff;
        }

        .clickable-box:hover {
            background-color: #f0f0f0;
        }

        .home-button {
            position: absolute;
            top: 20px;
            right: 20px;
            margin-right: 10px;
            padding: 10px 20px;
            background-color: #bd0606;
            color: #ffffff; /* í°ìƒ‰ìœ¼ë¡œ ë³€ê²½ */
            cursor: pointer;
            border: none;
            border-radius: 5px;
        }

        .home-button a {
            text-decoration: none;
            color: #ffffff; /* í°ìƒ‰ìœ¼ë¡œ ì„¤ì • */
        }

        .home-button a:hover {
            text-decoration: underline; /* ë°‘ì¤„ ì¶”ê°€ */
        }

        .context-menu {
            display: none;
            position: absolute;
            z-index: 1000;
            width: 100px;
            background-color: #fff;
            border: 1px solid #ccc;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            border-radius: 5px;
        }

        .context-menu-item {
            display: block;
            width: 100%;
            padding: 10px;
            background: none;
            border: none;
            text-align: left;
            cursor: pointer;
        }

        .context-menu-item:hover {
            background-color: #f0f0f0;
        }

    </style>

    <script>
        function goToParentDirectory() {
            var currentPath = document.getElementById('currentPath').value;
            var studyboardno = document.getElementById('studyboardno').value;

            if (currentPath === '/home/ec2-user/' + studyboardno) {
                return; // ë£¨íŠ¸ ê²½ë¡œì´ë©´ ìƒìœ„ í´ë”ë¡œ ì´ë™í•˜ì§€ ì•ŠìŒ
            }

            var lastIndex = currentPath.lastIndexOf('/');
            var parentPath = currentPath.substring(0, lastIndex);

            window.location.href = '/study/mine/filesharing?studyboardno=' + studyboardno + '&directoryPath=' + parentPath;
        }

        window.onload = function() {
            var currentPath = document.getElementById('currentPath').value;
            var studyboardno = document.getElementById('studyboardno').value;

            if (currentPath === '/home/ec2-user/' + studyboardno) {
                var goToParentButton = document.getElementById('goToParentButton');
                goToParentButton.style.display = 'none'; // ë£¨íŠ¸ ê²½ë¡œì´ë©´ ìƒìœ„ í´ë”ë¡œ ì´ë™ ë²„íŠ¼ ìˆ¨ê¹€
            }
        };

        function toggleCreateFolderForm() {
            var form = document.querySelector('.create-folder-form');
            form.style.display = (form.style.display === 'none' || form.style.display === '') ? 'block' : 'none';
        }

        function toggleUploadFileForm() {
            var form = document.querySelector('.upload-file-form');
            form.style.display = (form.style.display === 'none' || form.style.display === '') ? 'block' : 'none';
        }
    </script>
    <script th:inline="javascript">
        function truncateName(name, maxLength) {
            if (name.length <= maxLength) {
                return name;
            } else {
                var truncatedName = name.substr(0, maxLength - 3) + '...';
                return truncatedName;
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            var folderLinks = document.querySelectorAll('.folder-link span');
            var fileLinks = document.querySelectorAll('.file-link span');

            folderLinks.forEach(function(link) {
                var originalName = link.textContent;
                var truncatedName = truncateName(originalName, 15);
                link.textContent = truncatedName;
                link.setAttribute('title', originalName); // ì›ë³¸ ì´ë¦„ì„ title ì†ì„±ì— ì¶”ê°€í•˜ì—¬ ë§ˆìš°ìŠ¤ ì˜¤ë²„ ì‹œ ì „ì²´ ì´ë¦„ì„ ë³´ì—¬ì¤Œ
            });

            fileLinks.forEach(function(link) {
                var originalName = link.textContent;
                var truncatedName = truncateName(originalName, 15);
                link.textContent = truncatedName;
                link.setAttribute('title', originalName); // ì›ë³¸ ì´ë¦„ì„ title ì†ì„±ì— ì¶”ê°€í•˜ì—¬ ë§ˆìš°ìŠ¤ ì˜¤ë²„ ì‹œ ì „ì²´ ì´ë¦„ì„ ë³´ì—¬ì¤Œ
            });
        });
    </script>
    <script th:inline="javascript">
        function showContextMenu(event, type, name) {
            event.preventDefault();

            var contextMenu = document.getElementById('contextMenu');
            contextMenu.innerHTML = ''; // ê¸°ì¡´ì˜ ë©”ë‰´ ì´ˆê¸°í™”

            var deleteAction = document.createElement('div');
            deleteAction.textContent = (type === 'folder') ? 'í´ë” ì‚­ì œ' : 'íŒŒì¼ ì‚­ì œ';
            deleteAction.classList.add('context-menu-item');
            deleteAction.addEventListener('click', function() {
                // ì‚­ì œ ë¡œì§ì„ ì—¬ê¸°ì— êµ¬í˜„
                if (type === 'folder') {
                    alert('í´ë” ' + name + ' ì‚­ì œ');
                } else {
                    alert('íŒŒì¼ ' + name + ' ì‚­ì œ');
                }
            });
            contextMenu.appendChild(deleteAction);

            // ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ì˜ ìœ„ì¹˜ ì¡°ì •
            contextMenu.style.top = event.clientY + 'px';
            contextMenu.style.left = event.clientX + 'px';
            contextMenu.style.display = 'block';

            // ë‹¤ë¥¸ ê³³ì„ í´ë¦­í•˜ë©´ ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ë¥¼ ìˆ¨ê¹€
            document.addEventListener('click', function() {
                contextMenu.style.display = 'none';
            });
        }
    </script>

</head>
<body>
<div class="button-container">
    <button class="go-to-parent-button" id="goToParentButton" onclick="goToParentDirectory()">ìƒìœ„ í´ë”ë¡œ ì´ë™</button>
    <button class="create-folder-button" onclick="toggleCreateFolderForm()">ìƒˆ í´ë” ìƒì„±</button>
    <button class="upload-file-button" onclick="toggleUploadFileForm()">íŒŒì¼ ì—…ë¡œë“œ</button>
</div>
<div class="home-button">
    <a th:if="${not #lists.isEmpty(myStudyList)}"
       th:href="@{/study/mine(studyboardno=${studyboardno})}" class="home-link">ğŸ”™ë©”ì¸ìœ¼ë¡œ</a>
</div>

<div class="create-folder-form">
    <h2>ìƒˆ í´ë” ìƒì„±</h2>
    <form id="createForm" th:action="@{/study/folder/create}" method="post">
        <input type="hidden" id="currentPath" name="currentPath" th:value="${currentPath}">
        <input type="hidden" id="studyboardno" name="studyboardno" th:value="${studyboardno}">
        <label for="folderName">í´ë” ì´ë¦„:</label>
        <input type="text" id="folderName" name="folderName" required>
        <button type="submit">í´ë” ìƒì„±</button>
    </form>
</div>

<div class="upload-file-form">
    <h2>íŒŒì¼ ì—…ë¡œë“œ</h2>
    <form id="uploadForm" th:action="@{/study/file/upload}" method="post" enctype="multipart/form-data">
        <input type="hidden" name="currentPath" th:value="${currentPath}">
        <input type="hidden" name="studyboardno" th:value="${studyboardno}">
        <input type="file" name="file" required>
        <button type="submit">í™•ì¸</button>
    </form>
</div>

<!-- íŒŒì¼ ë‹¤ìš´ë¡œë“œ í¼ -->
<div class="download-file-form" th:if="${not #lists.isEmpty(filesToDownload)}">
    <h2>íŒŒì¼ ë‹¤ìš´ë¡œë“œ</h2>
    <ul>
        <li th:each="file : ${filesToDownload}">
            <form th:action="@{/study/file/download}" method="post">
                <input type="hidden" name="currentPath" th:value="${currentPath}">
                <input type="hidden" name="studyboardno" th:value="${studyboardno}">
                <input type="hidden" name="fileName" th:value="${file.name}">
                <button type="submit" th:text="${file.name}" th:download="${file.name}"></button>
            </form>
        </li>
    </ul>
</div>
<div class="main-content">
    <h1>ëª©ë¡ ë³´ê¸°</h1>
    <ul>
        <li th:each="folder : ${folders}">
            <a th:if="${folder.directory}"
               th:href="@{|/study/mine/filesharing?studyboardno=${studyboardno}&directoryPath=${currentPath}/${folder.name}|}"
               class="folder-link"
               oncontextmenu="showContextMenu(event, 'folder', '${folder.name}')">
                <div class="link-content">
                    <img src="https://i.ibb.co/XLG39JD/free-icon-folder-5613750.png" alt="folder-icon" />
                    <span th:text="${folder.name}"></span>
                </div>
            </a>
            <a th:unless="${folder.directory}"
               th:href="@{|/study/file/download?remoteFilePath=${currentPath}/${folder.name}|}"
               class="file-link"
               oncontextmenu="showContextMenu(event, 'file', '${folder.name}')">
                <div class="link-content">
                    <img th:if="${#strings.endsWith(folder.name, '.png')}"
                         src="https://i.ibb.co/LCSw7VV/free-icon-png-file-2786921.png"
                         alt="png-icon" />
                    <img th:if="${#strings.endsWith(folder.name, '.jpg')}"
                         src="https://i.ibb.co/s9Ptf56/free-icon-jpg-file-4861303.png"
                         alt="jpg-icon" />
                    <img th:if="${#strings.endsWith(folder.name, '.hwp')}"
                         src="https://example.com/file-icons/hwp-icon.png"
                         alt="hwp-icon" />
                    <img th:if="${#strings.endsWith(folder.name, '.avi')}"
                         src="https://example.com/file-icons/avi-icon.png"
                         alt="avi-icon" />
                    <img th:if="${#strings.endsWith(folder.name, '.mp4')}"
                         src="https://example.com/file-icons/mp4-icon.png"
                         alt="mp4-icon" />
                    <span th:text="${folder.name}"></span>
                </div>
            </a>
        </li>
    </ul>
</div>

<div id="contextMenu" class="context-menu">
    <button id="deleteButton" class="context-menu-item" onclick="deleteItem()">ì‚­ì œ</button>
</div>


</body>
</html>
